<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greek Payroll Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 50px; background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .result-card { border-left: 5px solid #007bff; }
    </style>
</head>
<body>
<div class="container">
    <div id="calculator-view">
        <h2 class="mb-4 text-primary">üá¨üá∑ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ì—Ä–µ—á–µ—Å–∫–æ–π –ó–∞—Ä–ø–ª–∞—Ç—ã</h2>
        <div class="card p-4">
            <h5 class="card-title">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</h5>
            <form id="payroll-form">
                <div class="mb-3">
                    <label for="grossSalary" class="form-label">–ë—Ä—É—Ç—Ç–æ-–∑–∞—Ä–ø–ª–∞—Ç–∞ (‚Ç¨)</label>
                    <input type="number" step="0.01" class="form-control" id="grossSalary" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1300.0">
                </div>
                <div class="mb-3">
                    <label for="contractType" class="form-label">–¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</label>
                    <select class="form-select" id="contractType" required>
                        <option value="full-time" selected>Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="freelance">Freelance</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
            </form>
            <div id="alertMessage" class="mt-3 alert alert-danger d-none" role="alert"></div>
        </div>
    </div>

    <div id="result-view" class="mt-5 d-none">
        <h2 class="mb-4">üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
        <div id="result-content" class="row"></div>
        <button id="back-button" class="btn btn-secondary mt-4">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const form = document.getElementById('payroll-form');
const calculatorView = document.getElementById('calculator-view');
const resultView = document.getElementById('result-view');
const resultContent = document.getElementById('result-content');
const backButton = document.getElementById('back-button');
const alertMessage = document.getElementById('alertMessage');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    alertMessage.classList.add('d-none');

    const grossSalary = document.getElementById('grossSalary').value;
    const contractType = document.getElementById('contractType').value;

    const data = { gross_salary: parseFloat(grossSalary), contract_type: contractType };

    try {
        const response = await fetch('/api/payroll', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        });
        const result = await response.json();

        if (!response.ok) {
            alertMessage.textContent = result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ.';
            alertMessage.classList.remove('d-none');
            return;
        }

        displayResults(result);

    } catch (error) {
        alertMessage.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.';
        alertMessage.classList.remove('d-none');
        console.error(error);
    }
});

function displayResults(data) {
    resultContent.innerHTML = '';

    const keysInOrder = [
        "Gross Salary (‚Ç¨)", 
        "EFKA Contribution (‚Ç¨)", 
        "Income Tax (‚Ç¨)", 
        "Vacation Pay Accrual (‚Ç¨)", 
        "Sick Pay Accrual (‚Ç¨)", 
        "Net Salary (‚Ç¨)"
    ];

    keysInOrder.forEach(key => {
        if (data.hasOwnProperty(key)) {
            const formattedValue = new Intl.NumberFormat('el-GR', { style: 'currency', currency: 'EUR' }).format(data[key]);
            let colorClass = 'text-dark';
            if (key === 'Net Salary (‚Ç¨)') colorClass = 'text-success';
            else if (key === 'EFKA Contribution (‚Ç¨)' || key === 'Income Tax (‚Ç¨)') colorClass = 'text-danger';
            else if (key === 'Vacation Pay Accrual (‚Ç¨)' || key === 'Sick Pay Accrual (‚Ç¨)') colorClass = 'text-info';

            const cardHtml = `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card result-card h-100">
                        <div class="card-body">
                            <p class="card-text mb-1">${key.replace(' (‚Ç¨)', '')}</p>
                            <h4 class="card-title ${colorClass}">${formattedValue}</h4>
                        </div>
                    </div>
                </div>
            `;
            resultContent.insertAdjacentHTML('beforeend', cardHtml);
        }
    });

    calculatorView.classList.add('d-none');
    resultView.classList.remove('d-none');
}

backButton.addEventListener('click', () => {
    calculatorView.classList.remove('d-none');
    resultView.classList.add('d-none');
    resultContent.innerHTML = '';
    alertMessage.classList.add('d-none');
});
</script>
</body>
</html>
