<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greek Salary Agent - Professional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; padding-top: 30px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .main-card { border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: none; background: white; }
        .history-table-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .result-box { 
            display: none; 
            background: #ffffff; 
            border-radius: 12px; 
            padding: 25px; 
            margin-top: 25px; 
            border: 1px solid #dee2e6;
            border-left: 6px solid #0d6efd;
            transition: all 0.5s ease;
        }
        .detail-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }
        .text-minus { color: #dc3545; font-weight: bold; }
        .text-plus { color: #198754; font-weight: bold; }
        .badge-net { font-size: 1.1rem; padding: 8px 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-9 col-lg-7">
            
            <div class="card main-card p-4">
                <h2 class="text-center mb-4">üá¨üá∑ Salary Agent <span class="badge bg-dark text-uppercase" style="font-size: 0.4em; vertical-align: middle;">Pro</span></h2>
                
                <form id="payroll-form">
                    <div class="mb-3">
                        <label class="form-label fw-bold">–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –ë—Ä—É—Ç—Ç–æ-–∑–∞—Ä–ø–ª–∞—Ç–∞ (‚Ç¨)</label>
                        <input type="number" id="grossSalary" class="form-control form-control-lg" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1500" step="0.01">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">–¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</label>
                        <select id="contractType" class="form-select form-select-lg">
                            <option value="full-time">Full-time (14 –∑–∞—Ä–ø–ª–∞—Ç)</option>
                            <option value="part-time">Part-time (12 –∑–∞—Ä–ø–ª–∞—Ç)</option>
                            <option value="freelance">Freelance</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg w-100 shadow-sm">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ –∑–∞–Ω–µ—Å—Ç–∏ –≤ —Ä–µ–µ—Å—Ç—Ä</button>
                </form>

                <div id="result-box" class="result-box">
                    <h5 class="text-center mb-3 fw-bold text-muted">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞</h5>
                    <div class="detail-item">
                        <span>–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (Gross):</span>
                        <span id="res-gross" class="fw-bold"></span>
                    </div>
                    <div class="detail-item">
                        <span>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ EFKA (16%):</span>
                        <span id="res-efka" class="text-minus"></span>
                    </div>
                    <div class="detail-item">
                        <span>–ü–æ–¥–æ—Ö–æ–¥–Ω—ã–π –Ω–∞–ª–æ–≥ (20%):</span>
                        <span id="res-tax" class="text-minus"></span>
                    </div>
                    <div class="detail-item">
                        <span>–ë–æ–Ω—É—Å—ã (–û—Ç–ø—É—Å–∫–Ω—ã–µ/–ë–æ–ª—å–Ω–∏—á–Ω—ã–µ):</span>
                        <span id="res-bonuses" class="text-plus"></span>
                    </div>
                    <hr>
                    <div class="text-center mt-3">
                        <div class="text-muted small">–ò–¢–û–ì–û –ù–ê –†–£–ö–ò (NET):</div>
                        <div id="net-result" class="display-6 fw-bold text-primary"></div>
                    </div>
                    <div class="text-center mt-4">
                        <button onclick="location.reload()" class="btn btn-outline-primary">–ü–æ–Ω—è—Ç–Ω–æ, –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä</button>
                    </div>
                </div>
            </div>

            <div class="mt-5 mb-5">
                <h4 class="mb-3">üìú –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π —Ä–µ–µ—Å—Ç—Ä (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 3)</h4>
                <div class="history-table-container">
                    <table class="table table-hover mb-0 text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>–ë—Ä—É—Ç—Ç–æ</th>
                                <th>–í—ã—á–µ—Ç—ã(-)</th>
                                <th>–ë–æ–Ω—É—Å—ã(+)</th>
                                <th>–ù–∞ —Ä—É–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in history %}
                            <tr>
                                <td class="fw-bold">{{ row.gross }}‚Ç¨</td>
                                <td class="text-danger small">-{{ (row.efka + row.tax)|round(2) }}‚Ç¨</td>
                                <td class="text-success small">+{{ row.bonuses }}‚Ç¨</td>
                                <td><span class="badge bg-primary badge-net">{{ row.net }}‚Ç¨</span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
const form = document.getElementById('payroll-form');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        gross_salary: document.getElementById('grossSalary').value,
        contract_type: document.getElementById('contractType').value
    };

    try {
        const response = await fetch('/api/payroll', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        
        if (response.ok) {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ü–∏—Ñ—Ä—ã –≤ –±–ª–æ–∫–µ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
            document.getElementById('res-gross').textContent = result['Gross Salary (‚Ç¨)'] + ' ‚Ç¨';
            document.getElementById('res-efka').textContent = '-' + result['EFKA Contribution (‚Ç¨)'] + ' ‚Ç¨';
            document.getElementById('res-tax').textContent = '-' + result['Income Tax (‚Ç¨)'] + ' ‚Ç¨';
            
            const bonusTotal = (result['Vacation Pay Accrual (‚Ç¨)'] + result['Sick Pay Accrual (‚Ç¨)']).toFixed(2);
            document.getElementById('res-bonuses').textContent = '+' + bonusTotal + ' ‚Ç¨';
            
            document.getElementById('net-result').textContent = result['Net Salary (‚Ç¨)'] + ' ‚Ç¨';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –ø–ª–∞–≤–Ω–æ
            const resultBox = document.getElementById('result-box');
            resultBox.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }
    } catch (error) { 
        console.error('–û—à–∏–±–∫–∞:', error); 
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç.');
    }
});
</script>

</body>
</html>